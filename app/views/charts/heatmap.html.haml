%h1 Expense Heatmap

.heatmap-controls
  = form_with url: heatmap_charts_path, method: :get, data: { turbo_frame: 'heatmap_content' } do |f|
    = f.label :year, 'Select Year:'
    = f.select :year, options_for_select(@available_years, @selected_year), {}, { onchange: 'this.form.requestSubmit()' }

= turbo_frame_tag 'heatmap_content' do
  .heatmap-container
    %h2 Daily Expenses - #{@selected_year}
    .heatmap-legend
      %span.legend-label Low
      .legend-gradient
      %span.legend-label High
      %span.legend-max= "(Max: #{number_to_currency(@heatmap_data[:max_expense])})"
    
    .heatmap-wrapper{ 
      data: { 
        controller: 'heatmap',
        'heatmap-data-value': @heatmap_data.to_json
      }
    }
      %svg#expense-heatmap{ width: '100%', height: '170', viewBox: '0 0 954 170' }

%style
  :css
    .heatmap-container {
      margin: 20px 0;
    }
    
    .heatmap-controls {
      margin-bottom: 20px;
    }
    
    .heatmap-legend {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      gap: 10px;
    }
    
    .legend-gradient {
      width: 200px;
      height: 20px;
      background: linear-gradient(to right, #f0f0f0, #fee, #fcc, #f99, #f66, #f33, #c00);
      border: 1px solid #ddd;
      border-radius: 3px;
    }
    
    .legend-label {
      font-size: 12px;
      color: #666;
    }
    
    .legend-max {
      margin-left: 10px;
      font-size: 12px;
      color: #666;
    }
    
    .heatmap-wrapper {
      overflow-x: auto;
      padding: 10px;
      background: white;
      border-radius: 5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    #expense-heatmap {
      min-width: 954px;
    }